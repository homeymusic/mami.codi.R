---
title: "Major-Minor and Consonance-Dissonance Perception"
output:
  github_document: default
---

# MaMi CoDi

For the MaMi.CoDi model as it existed for the ICMPC 2023 poster session at Tokyo, see [MaMi.CoDi vICMPC17](https://github.com/homeymusic/mami.codi.R/tree/vICMPC17).

```{r, echo=F, message=F, include=F}
devtools::load_all(".")
source('./man/code/plot.R')
source('./man/code/utils.R')
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)
BEHAVIOURAL_SMOOTH_BROAD  <- 0.2
BEHAVIOURAL_SMOOTH_NARROW <- 0.035
```

# MaMi CoDi Plots

```{r, include=F}
chord_types <- c('Dyads','Triads','Major Triad Progressions',
                 'Minor Triad Progressions', 'Scales')
chords <- chords %>% dplyr::filter(type %in% chord_types)

major_I = chords %>% dplyr::filter(type == 'Major Triad Progressions' &
                                     label == 'I')
minor_i = chords %>% dplyr::filter(type == 'Minor Triad Progressions' &
                                     label == 'i')

progression_tonics = list(
  # 'Major Triad Progressions 1' = (major_I$pitches[[1]] %>%
  #                                   mami.codi(num_harmonics=1))$chord[[1]],
  # 'Minor Triad Progressions 1' = (minor_i$pitches[[1]] %>% 
  #                                   mami.codi(num_harmonics=1))$chord[[1]],
  'Major Triad Progressions 5' = (major_I$pitches[[1]] %>%
                                    mami.codi(num_harmonics=5))$chord[[1]],
  'Minor Triad Progressions 5' = (minor_i$pitches[[1]] %>% 
                                    mami.codi(num_harmonics=5))$chord[[1]],
  'Major Triad Progressions 10' = (major_I$pitches[[1]] %>%
                                     mami.codi(num_harmonics=10))$chord[[1]],
  'Minor Triad Progressions 10' = (minor_i$pitches[[1]] %>% 
                                     mami.codi(num_harmonics=10))$chord[[1]]
)

```

```{r, include=F}
grid = tidyr::expand_grid(
  index         = seq_along(chords$pitches),
  num_harmonics = c(1, 2, 3, 6, 11)
)

results = grid %>% purrr::pmap_dfr(\(index,
                                     num_harmonics) {

  chord_spectrum = hrep::sparse_fr_spectrum(chords$pitches[[index]],
                                            num_harmonics = num_harmonics)
  
  mami.codi(chord_spectrum,
            metadata=purrr::flatten(
              list(chords$metadata[[index]],
                   num_harmonics=num_harmonics)
            ),
            verbose=T)
})

results <- results %>% dplyr::rowwise() %>% dplyr::mutate(
  label = metadata$label,
  type  = metadata$type, 
  num_harmonics=metadata$num_harmonics,
  .before=1
)
```

## Chords: Consonance-Dissonance ~ Major-Minor

```{r, echo=F, message=F, results='asis'}
for (t in chord_types) {
  
  cat("  \n###", t, '\n')
  
  for (n in results$num_harmonics %>% unique) {
    title = paste(
      t,
      '~',
      'Number of Harmonics:', n
    )
    r = results %>% dplyr::filter(
      type==t & 
        num_harmonics == n
    )
    print(plot_mami.codi(r, title, include_path=endsWith(t, 'Progressions'),
                         include_labels=T))
  }
  
  cat("  \n")
  
}
```
